<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>加一尚品COYEEE——购物车</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <link rel="stylesheet" href="./css/all.css">
</head>
<body class="layout-body body-page-cart">
    <section class="page-cart">
        <header class="layout-header mod-layout-header clearfix">
            <div class="title">购物车</div>
            <a href="" class="link-back"><</a>
        </header>
        <section class="layout-main main">
            <div class="hd">
                <div>全部商品：<span class="all-num"></span></div>
                <div>库存紧张：<span class="none-num"></span></div>
            </div>
            <div class="bd">
                <dl class="list">
                    <dt>
                        <div class="select-all"><i class="icon icon-radio"></i>全选</div>
                        <div>已选商品：<span class="choose-num">0</span></div>
                    </dt>
                    <dd>
                        <div class="inner">
                            <div><i class="icon icon-radio"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="info">
                                        <span class="color">颜色分类：黑色</span>
                                        <span class="size">颜色分类：170(XL)</span>
                                    </div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">250</span></span>×<span class="num">1</span></div>
                                            <div>
                                                <a href="javascript:;" class="handle">操作</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="handle-bar-wrap">
                                        <div class="handle-bar">
                                            <div class="change-num">
                                                <span class="minus">-</span>
                                                <span class="input-num"><input type="text" value="1" onkeyup='this.value=this.value.replace(/\D/gi,"")'></span>
                                                <span class="plus">+</span>
                                            </div>
                                            <div>
                                                <a href="javascript:;" class="delete">删除</a>
                                                <a href="javascript:;" class="finish">完成</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd>
                        <div class="inner">
                            <div><i class="icon icon-radio"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="info">
                                        <span class="color">颜色分类：黑色</span>
                                        <span class="size">颜色分类：170(XL)</span>
                                    </div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">350</span></span>×<span class="num">1</span></div>
                                            <div>
                                                <a href="javascript:;" class="handle">操作</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="handle-bar-wrap">
                                        <div class="handle-bar">
                                            <div class="change-num">
                                                <span class="minus">-</span>
                                                <span class="input-num"><input type="text" value="1" onkeyup='this.value=this.value.replace(/\D/gi,"")'></span>
                                                <span class="plus">+</span>
                                            </div>
                                            <div>
                                                <a href="javascript:;" class="delete">删除</a>
                                                <a href="javascript:;" class="finish">完成</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd>
                        <div class="inner">
                            <div><i class="icon icon-radio"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="info">
                                        <span class="color">颜色分类：黑色</span>
                                        <span class="size">颜色分类：170(XL)</span>
                                    </div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">150</span></span>×<span class="num">1</span></div>
                                            <div>
                                                <a href="javascript:;" class="handle">操作</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="handle-bar-wrap">
                                        <div class="handle-bar">
                                            <div class="change-num">
                                                <span class="minus">-</span>
                                                <span class="input-num"><input type="text" value="1" onkeyup='this.value=this.value.replace(/\D/gi,"")'></span>
                                                <span class="plus">+</span>
                                            </div>
                                            <div>
                                                <a href="javascript:;" class="delete">删除</a>
                                                <a href="javascript:;" class="finish">完成</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd class="none">
                        <div class="inner">
                            <div><i class="icon icon-radio-none"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="info">
                                        <span class="color">颜色分类：黑色</span>
                                        <span class="size">颜色分类：170(XL)</span>
                                    </div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">250</span></span>×<span class="num">1</span></div>
                                            <div>
                                                <a href="javascript:;" class="handle">操作</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="handle-bar-wrap">
                                        <div class="handle-bar">
                                            <div class="change-num">
                                                <span class="minus">-</span>
                                                <span class="input-num"><input type="text" value="1" onkeyup='this.value=this.value.replace(/\D/gi,"")'></span>
                                                <span class="plus">+</span>
                                            </div>
                                            <div>
                                                <a href="javascript:;" class="delete">删除</a>
                                                <a href="javascript:;" class="finish">完成</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                </dl>
            </div>
        </section>
        <section class="layout-footer mod-order-submit">
            <div class="left">
                <div class="price">实付：￥<span class="total-cost">0</span></div>
                <div class="detail">包含商品：<span class="total-num">0</span>件</div>
            </div>
            <div class="right"><a href="javascript:;">去结算</a></div>
        </section>
    </section>
</body>
<script src="./lib/zepto/zepto.min.js"></script>
<script src="./js/all.js"></script>
<script>
    $(function(){

        var CoyeeeCart = {

            init: function(){
                this.render();
                this.bind();
            },

            render: function(){
                this.oList = $(".list");
                this.oSelectAll = $(".select-all");
                this.iAllNum = $(".all-num");
                this.iNoneNum = $(".none-num");
                this.iChooseNum = $(".choose-num");
                this.iTotalCost = $(".total-cost");
                this.iTotalNum = $(".total-num");
                this.oMinus = $(".minus");
                this.oPlus = $(".plus");
                this.oHandle = $(".handle");
                this.oDelete = $(".delete");
                this.oFinish = $(".finish");
            },

            bind: function(){
                var self = this;

                // 上来先获取全部商品数量和库存紧张数量
                // dd的类名为none表示库存紧张
                self.iAllNum.html(self.allNumHandle());
                self.iNoneNum.html(self.noneNumHandle());

                // 模拟多选框 选中商品
                self.oList.find("dd .icon").on("click", function(){
                    if($(this).hasClass("icon-radio")){
                        $(this).removeClass("icon-radio").addClass("icon-radio-active");
                    }else if($(this).hasClass("icon-radio-active")){
                        $(this).removeClass("icon-radio-active").addClass("icon-radio");
                    }
                    if(!self.isSelectAllHandle()){
                        self.oSelectAll.find(".icon").removeClass("icon-radio-active").addClass("icon-radio");
                    }else{
                        self.oSelectAll.find(".icon").removeClass("icon-radio").addClass("icon-radio-active");
                    }
                    self.iChooseNum.html(self.chooseNumHandle());
                    self.iTotalNum.html(self.productNumHandle());
                    self.iTotalCost.html(self.productCostHandle());
                });

                // 全选框
                self.oSelectAll.on("click", function(){
                    if($(this).find(".icon").hasClass("icon-radio")){
                        $(this).find(".icon").removeClass("icon-radio").addClass("icon-radio-active");
                        self.oList.find("dd .icon").each(function(){
                            if($(this).hasClass("icon-radio")){
                                $(this).removeClass("icon-radio").addClass("icon-radio-active");
                            }
                        });
                    }else{
                        $(this).find(".icon").removeClass("icon-radio-active").addClass("icon-radio");
                        self.oList.find("dd .icon").each(function(){
                            if($(this).hasClass("icon-radio-active")){
                                $(this).removeClass("icon-radio-active").addClass("icon-radio");
                            }
                        });
                    }
                    self.iChooseNum.html(self.chooseNumHandle());
                    self.iTotalNum.html(self.productNumHandle());
                    self.iTotalCost.html(self.productCostHandle());
                });

                // 减少商品数量
                self.oMinus.on("click", function(){
                    if(parseInt($(this).next().find("input").val()) > 1){
                        $(this).next().find("input").val(parseInt($(this).next().find("input").val()) - 1);
                    }
                });

                // 添加商品数量
                self.oPlus.on("click", function(){
                    $(this).prev().find("input").val(parseInt($(this).prev().find("input").val()) + 1);
                });

                // 点击操作 显示商品添加组件及删除 完成
                // 并且隐藏商品名称
                self.oHandle.on("click", function(){
                    var oWrap =  $(this).parents(".price-bar-wrap");
                    $(this).hide();
                    oWrap.siblings(".title").hide();
                    oWrap.next().show();
                });

                // 点击完成 反之
                // 并且重新计算一遍购物车商品总数量和总价格
                self.oFinish.on("click", function(){
                    var oWrap = $(this).parents(".handle-bar-wrap");
                    oWrap.hide();
                    oWrap.prev().find(".handle").show();
                    oWrap.siblings(".title").show();
                    oWrap.prev().find(".num").html(parseInt(oWrap.find(".input-num input").val()));

                    self.iChooseNum.html(self.chooseNumHandle());
                    self.iTotalNum.html(self.productNumHandle());
                    self.iTotalCost.html(self.productCostHandle());
                });

                // 点击删除  同理需要重新计算一遍购物车商品总数量和总价格
                // 并且重新计算全部商品和库存紧张
                self.oDelete.on("click", function(){
                    $(this).parents("dd").remove();
                    self.iAllNum.html(self.allNumHandle());
                    self.iNoneNum.html(self.noneNumHandle());

                    self.iChooseNum.html(self.chooseNumHandle());
                    self.iTotalNum.html(self.productNumHandle());
                    self.iTotalCost.html(self.productCostHandle());
                });
            },

            allNumHandle: function(){
                var self = this;
                var iOldAllNum = self.oList.find("dd").length;
                var iNewAllNum = 0;

                self.oList.find("dd").each(function(){
                    if($(this).hasClass("none")){
                        iOldAllNum = iOldAllNum - 1;
                        iNewAllNum = iOldAllNum;
                    }else {
                        iNewAllNum = iOldAllNum;
                    }
                });

                return iNewAllNum;
            },

            noneNumHandle: function(){
                var self = this;
                var iNoneNum = 0;

                self.oList.find("dd").each(function(){
                    if($(this).hasClass("none")){
                        iNoneNum++;
                    }
                });

                return iNoneNum;
            },

            chooseNumHandle: function(){
                var self = this;
                var iChooseNum = 0;

                self.oList.find("dd .icon").each(function(){
                    if($(this).hasClass("icon-radio-active")){
                        iChooseNum++;
                    }
                });

                return iChooseNum;
            },

            isSelectAllHandle: function(){
                var self = this;
                var bIsSelectAll = true;

                self.oList.find("dd .icon").each(function(){
                    if($(this).hasClass("icon-radio")){
                        bIsSelectAll = false;
                    }
                });

                return bIsSelectAll;
            },

            productNumHandle: function(){
                var self = this;
                var iTotalNum = 0;

                self.oList.find("dd").each(function(){
                    if(!$(this).hasClass("none") && $(this).find(".icon").hasClass("icon-radio-active")){
                        iTotalNum += parseInt($(this).find(".num").html());
                    }
                });

                return iTotalNum;
            },

            productCostHandle: function(){
                var self = this;
                var iTotalCost = 0;

                self.oList.find("dd").each(function(){
                    if(!$(this).hasClass("none") && $(this).find(".icon").hasClass("icon-radio-active")){
                        iTotalCost += parseInt($(this).find(".price").html()) * parseInt($(this).find(".num").html());
                    }
                });

                return iTotalCost;
            }
        };

        CoyeeeCart.init();

    });
</script>
</html>
