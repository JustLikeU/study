<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>加一尚品COYEEE——收藏夹</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <link rel="stylesheet" href="./css/all.css">
</head>
<body class="layout-body body-page-cart">
    <section class="mod-mask" id="J-mod-mask"></section>
    <section class="page-add-cart" id="J-page-add-cart">
        <section class="product">
            <div class="pic"><img src="./img/test2.jpg" alt=""></div>
            <div class="text">
                <div class="price">
                    ￥169
                </div>
                <div class="left">
                    库存1680件
                </div>
            </div>
        </section>
        <section class="buy">
            <div class="mod-detail-title title"><span class="name">选择颜色</span><span class="line"></span></div>
            <ul class="mod-list color-list">
                <li>
                    <div><span class="inner active"><img src="./img/test3.jpg" alt=""></span></div>
                    <div><span class="inner"><img src="./img/test3.jpg" alt=""></span></div>
                    <div><span class="inner"><img src="./img/test3.jpg" alt=""></span></div>
                    <div><span class="inner"><img src="./img/test3.jpg" alt=""></span></div>
                    <div><span class="inner"><img src="./img/test3.jpg" alt=""></span></div>
                </li>
                <li>
                    <div><span class="inner"><img src="./img/test3.jpg" alt=""></span></div>
                    <div><span class="inner"><img src="./img/test3.jpg" alt=""></span></div>
                    <!-- 即使没有也要保留空标签 布局需要 -->
                    <div></div>
                    <div></div>
                    <div></div>
                </li>
            </ul>
            <div class="mod-detail-title title"><span class="name">选择尺寸</span><span class="line"></span></div>
            <ul class="mod-list size-list">
                <li>
                    <div><span class="inner active">75A</span></div>
                    <div><span class="inner">75B</span></div>
                    <!-- 即使没有也要保留空标签 布局需要 -->
                    <div></div>
                    <div></div>
                    <div></div>
                </li>
                <li>
                    <div><span class="inner">80A</span></div>
                    <div><span class="inner">80B</span></div>
                    <div><span class="inner">80C</span></div>
                    <div><span class="inner">85A</span></div>
                    <div><span class="inner">90A</span></div>
                </li>
            </ul>
            <div class="mod-detail-title title"><span class="name">选择数量</span><span class="line"></span></div>
            <div class="count">
                <span class="minus">-</span>
                <span class="num"><input type="text" value="1" onkeyup='this.value=this.value.replace(/\D/gi,"")'></span>
                <span class="plus">+</span>
            </div>
        </section>
        <a href="" class="btn btn-buy">加入购物车</a>
    </section>
    <section class="page-cart page-collect">
        <header class="layout-header mod-layout-header clearfix">
            <div class="title">收藏夹</div>
            <a href="" class="link-back"><</a>
        </header>
        <section class="layout-main main">
            <div class="hd">
                <div>全部商品：<span class="all-num"></span></div>
                <div>库存紧张：<span class="none-num"></span></div>
            </div>
            <div class="bd">
                <dl class="list">
                    <dt>
                        <div class="select-all"><i class="icon icon-radio"></i>全选</div>
                        <div>已选商品：<span class="choose-num">0</span></div>
                    </dt>
                    <dd>
                        <div class="inner">
                            <div><i class="icon icon-radio"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">250</span></span></div>
                                            <i class="icon icon-cart"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd>
                        <div class="inner">
                            <div><i class="icon icon-radio"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">350</span></span></div>
                                            <i class="icon icon-cart"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd>
                        <div class="inner">
                            <div><i class="icon icon-radio"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">150</span></span></div>
                                            <i class="icon icon-cart"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd class="none">
                        <div class="inner">
                            <div><i class="icon icon-radio-none"></i></div>
                            <div>
                                <div class="pic"><a href=""><img src="./img/test3.jpg" alt=""></a></div>
                                <div class="text">
                                    <div class="title"><a href="">2016春夏新品曼妮芬加一尚品光面女内衣美背聚拢立体杯文胸M12-002</a></div>
                                    <div class="price-bar-wrap">
                                        <div class="price-bar">
                                            <div><span class="orange">￥<span class="price">250</span></span></div>
                                            <i class="icon icon-cart"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                </dl>
            </div>
        </section>
        <section class="layout-footer mod-order-submit">
            <a href="javascript:;" class="collect-edit" id="J-collect-edit">编辑</a>
            <div class="left" style="display:none;">
                <div class="detail">已选：<span class="total-num">0</span>件</div>
            </div>
            <div class="right" style="display:none;">
                <a href="javascript:;" id="J-btn-cancel">取消</a><a href="javascript:;" id="J-btn-delete">删除</a>
            </div>
        </section>
    </section>
</body>
<script src="./lib/zepto/zepto.min.js"></script>
<script src="./js/all.js"></script>
<script>
    $(function(){

        // 修改版本 start
        var oMinus = $(".minus");
        var oNum = $(".num").find("input");
        var oPlus = $(".plus");

        oMinus.on("click", function(){
            if(parseInt(oNum.val()) > 1){
                oNum.val(parseInt(oNum.val()) - 1);
            }
        });

        oPlus.on("click", function(){
            oNum.val(parseInt(oNum.val()) + 1);
        });

        handleRadio($(".size-list"), "inner");
        handleRadio($(".color-list"), "inner");

        var pageAddCart = $("#J-page-add-cart");
        var modMask = $("#J-mod-mask");
        pageAddCart.css("bottom", -pageAddCart.height()-30);
        $(".icon-cart").on("click", function(){
            modMask.show();
            pageAddCart.css("bottom", 0);
        });

        modMask.on("click", function(){
            modMask.hide();
            pageAddCart.css("bottom", -pageAddCart.height()-30);
        });
        // end

        var CoyeeeCart = {

            init: function(){
                this.render();
                this.bind();
            },

            render: function(){
                this.oList = $(".list");
                this.oSelectAll = $(".select-all");
                this.iAllNum = $(".all-num");
                this.iNoneNum = $(".none-num");
                this.iChooseNum = $(".choose-num");
                this.iTotalNum = $(".total-num");
                this.editBtn = $("#J-collect-edit");
                this.cancelBtn = $("#J-btn-cancel");
                this.deleteBtn = $("#J-btn-delete");
            },

            bind: function(){
                var self = this;

                // 上来先获取全部商品数量和库存紧张数量
                // dd的类名为none表示库存紧张
                self.iAllNum.html(self.allNumHandle());
                self.iNoneNum.html(self.noneNumHandle());

                // 模拟多选框 选中商品
                self.oList.find("dd .icon").on("click", function(){
                    if($(this).hasClass("icon-radio")){
                        $(this).removeClass("icon-radio").addClass("icon-radio-active");
                    }else if($(this).hasClass("icon-radio-active")){
                        $(this).removeClass("icon-radio-active").addClass("icon-radio");
                    }
                    if(!self.isSelectAllHandle()){
                        self.oSelectAll.find(".icon").removeClass("icon-radio-active").addClass("icon-radio");
                    }else{
                        self.oSelectAll.find(".icon").removeClass("icon-radio").addClass("icon-radio-active");
                    }
                    self.iChooseNum.html(self.chooseNumHandle());
                    self.iTotalNum.html(self.productNumHandle());
                });

                // 全选框
                self.oSelectAll.on("click", function(){
                    if($(this).find(".icon").hasClass("icon-radio")){
                        $(this).find(".icon").removeClass("icon-radio").addClass("icon-radio-active");
                        self.oList.find("dd .icon").each(function(){
                            if($(this).hasClass("icon-radio")){
                                $(this).removeClass("icon-radio").addClass("icon-radio-active");
                            }
                        });
                    }else{
                        $(this).find(".icon").removeClass("icon-radio-active").addClass("icon-radio");
                        self.oList.find("dd .icon").each(function(){
                            if($(this).hasClass("icon-radio-active")){
                                $(this).removeClass("icon-radio-active").addClass("icon-radio");
                            }
                        });
                    }
                    self.iChooseNum.html(self.chooseNumHandle());
                    self.iTotalNum.html(self.productNumHandle());
                });

                // 编辑状态
                self.editBtn.on("click", function(){
                    $(this).hide();
                    $(this).siblings().show();
                    $(".icon-cart").hide();
                });

                self.cancelBtn.on("click", function(){
                    self.editBtn.show();
                    self.editBtn.siblings().hide();
                    $(".icon-cart").show();
                });

                self.deleteBtn.on("click", function(){
                    self.oList.find("dd").each(function(){
                        if(!$(this).hasClass("none") && $(this).find(".icon").hasClass("icon-radio-active")){
                            $(this).remove();
                            self.iChooseNum.html(self.chooseNumHandle());
                            self.iTotalNum.html(self.productNumHandle());
                        }
                    });
                });
            },

            allNumHandle: function(){
                var self = this;
                var iOldAllNum = self.oList.find("dd").length;
                var iNewAllNum = 0;

                self.oList.find("dd").each(function(){
                    if($(this).hasClass("none")){
                        iOldAllNum = iOldAllNum - 1;
                        iNewAllNum = iOldAllNum;
                    }else {
                        iNewAllNum = iOldAllNum;
                    }
                });

                return iNewAllNum;
            },

            noneNumHandle: function(){
                var self = this;
                var iNoneNum = 0;

                self.oList.find("dd").each(function(){
                    if($(this).hasClass("none")){
                        iNoneNum++;
                    }
                });

                return iNoneNum;
            },

            chooseNumHandle: function(){
                var self = this;
                var iChooseNum = 0;

                self.oList.find("dd .icon").each(function(){
                    if($(this).hasClass("icon-radio-active")){
                        iChooseNum++;
                    }
                });

                return iChooseNum;
            },

            isSelectAllHandle: function(){
                var self = this;
                var bIsSelectAll = true;

                self.oList.find("dd .icon").each(function(){
                    if($(this).hasClass("icon-radio")){
                        bIsSelectAll = false;
                    }
                });

                return bIsSelectAll;
            },

            productNumHandle: function(){
                var self = this;
                var iTotalNum = 0;

                self.oList.find("dd").each(function(){
                    if(!$(this).hasClass("none") && $(this).find(".icon").hasClass("icon-radio-active")){
                        iTotalNum += 1;
                    }
                });

                return iTotalNum;
            }
        };

        CoyeeeCart.init();

    });
</script>
</html>
